- Вспомнить принцип DIP
- Картинка бизнес логика зависит от базы,  логика не зависит от бд, а зависит от абстрактного репозитория
- Легко писать тесты, когда предметная облать чистая без бд, но без базы данных некуда
- Пример Как будет выглядеть первая конечная точка API картинка. Фреймворк не важен
- Подход MVC, django MVT - трехслойная архитектура в сравнении с луковой архитектурой = чистой архитектурой = гексогональной архитектурой
- ORM дает неосведомленность об используемой системе постоянного хранения: ее суть в том, что наша капризная модель предметной области не должна ничего знать о способах загрузки или хранения данных. Это помогает держать модель независимой от конкретных технологий баз данных. **Используя ОРМ, мы не зависим от конкретной БД, а зависим от абстрактой ОРМ, но этого недостаточно** **т.к. такая модель все равно отражает свойства БД**
- ОРМ представление данных для хранения зависит от модели предмтеной области
- mapper
- alembic для миграции и делать запросы прозрачно с помощью классов предметной области, в чем мы позже убедимся.
- **Абстрактные классы** для определнеия базовых репозиториев или же **протоколы** (лучше потому что не нужно наследование - утинная типизация)
- Все есть компромис. 
- Когда мы вводим паттерн, нужно спрашивать себя, а для чего, что он решает. И что мы заплатим за это. 
  
  Введение паттерна Репозиторий помогает упростить и отделить логику БД от бизнес логики, но теперь становистя больше двигающихся частей, добавляется абстракция и сложность понимания и поддержки для новых разработчиков  увеличивается. 
  Кажды раз когда мы добавляем объект предметной области, нужно будет писать несколько строк в репозитории 
  
- Репозиторий помогаем заменить абстрацию ОРМ, на абстракцию созданную нами (простую), получаю тем самым контроль над ее интерфейсом. Контроль над абстракцией
- Репозиторий помогает тестировать код без обращения к конкретному способу хранения (БД)
- Части составляющие систему, работающие вместе (moving parts)
- Инетграционные тесты для проверки работоспособности репозитория. Каждый тест проверят только одно действие (add либо get и использует raw sql для проверки)
- Для entity лучше использовать сырые классы для value object - dataclass 
- 1 **Тест «туда-обратно»** (round-trip test) — это тест, который взаимодействует только через «входную дверь» (публичный интерфейс) тестируемой системы. — Примеч. пер.
  
  Используем только публичные методы класса без знания внутренностей. Тест кейс: Создать пользоватя (username, email), получаем в ответе id пользователя. Делаем запрос по этому id и сравниваем что созданные значения равны полученным
- Не обязательно использовать ОРМ, можно просто использовать SQL. А главное что отсальной часте приложения все равно
- Поддельный репозиторий для тестов
- Порт = интерфейс, адаптер = реализация
- Не всегда стоит усложнят код вводя паттерны и абстракции типо репозитория (только если сложный домен)
![[Pasted image 20250425110127.png]]


![[Pasted image 20250425110250.png]]