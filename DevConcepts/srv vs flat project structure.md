Source: Chatgpt: https://chatgpt.com/s/dr_6811dcb8b32881919e8a014f3d7a082d

# `src/` Layout in Python Projects

Python projects can organize their code in a **flat** layout (package folder at the repo root) or a **src** layout (with a top-level `src/` directory containing the package). For example, a flat layout might have `setup.py` and `my_pkg/` alongside each other; a src layout moves `my_pkg/` under `src/` (so you’d have `src/my_pkg/`)​[packaging.python.org](https://packaging.python.org/en/latest/discussions/src-layout-vs-flat-layout/#:~:text=The%20%E2%80%9Csrc%20layout%E2%80%9D%20deviates%20from,hence%20%E2%80%9Csrc%20layout%E2%80%9D). The Python Packaging Authority (PyPA) documentation and many experts explain that this extra `src/` directory yields important benefits (and trade-offs) for production packages.

## Rationale for Using `src/`

- **Prevents importing local source by accident:** By default Python puts the current directory on its import path. In a flat layout this means running code or tests in your repo will import the _local_ `my_pkg/` even if your package isn’t installed. In contrast, with `src/`, the package code is not on the path unless installed, so your imports will use the installed version​[packaging.python.org](https://packaging.python.org/en/latest/discussions/src-layout-vs-flat-layout/#:~:text=,development%20copy%20of%20the%20code)​[pyopensci.org](https://www.pyopensci.org/python-package-guide/package-structure-code/python-package-structure.html#:~:text=This%20means%20that%20if%20you,it%20discovers%20the%20installed%20package). This avoids the common problem where tests pass locally (importing the source files) but the published package is broken.
    
- **Forces testing of the installed package:** Relatedly, putting code under `src/` _forces_ you to install the package (e.g. `pip install -e .`) before running it. That ensures tests and development always run against the built package, catching packaging or dependency issues early​[blog.ionelmc.ro](https://blog.ionelmc.ro/2014/05/25/python-packaging/#the-structure#:~:text=,script)​[pyopensci.org](https://www.pyopensci.org/python-package-guide/package-structure-code/python-package-structure.html#:~:text=The%20benefit%20of%20using%20the,when%20your%20package%20is%20installed). As Ionel Mărieș explains, this “ensures that the deployed code works – otherwise your tests will fail. Early”​[blog.ionelmc.ro](https://blog.ionelmc.ro/2014/05/25/python-packaging/#the-structure#:~:text=,script). Similarly, the pytest docs “strongly suggest” a `src` layout so tests run against the installed package​[docs.pytest.org](https://docs.pytest.org/en/7.1.x/explanation/goodpractices.html#:~:text=Generally%2C%20but%20especially%20if%20you,mypkg).
    
- **Keeps project metadata out of imports:** In a flat layout, project files (e.g. `setup.py`, `README.md`, `tox.ini`, etc.) sit alongside your package. In editable installs this can pollute the import path. The src layout isolates the package under `src/`, so only the intended modules are importable. The packaging guide notes this “enforces that an editable installation is only able to import files that were meant to be importable”​[packaging.python.org](https://packaging.python.org/en/latest/discussions/src-layout-vs-flat-layout/#:~:text=,were%20meant%20to%20be%20importable), avoiding confusion where code can import tools or configs in development but not when installed.
    
- **Simpler packaging code and manifest:** Splitting code from config makes packaging scripts simpler. For example, putting data files or templates is easier when the package root is under `src/`. Ionel notes that with `src/` you get “clear separation of code being packaged and code doing the packaging,” and writing a `MANIFEST.in` is much simpler​[blog.ionelmc.ro](https://blog.ionelmc.ro/2014/05/25/python-packaging/#the-structure#:~:text=,and%20code%20doing%20the%20packaging). You avoid the common pitfall of importing your package in `setup.py` (which might trigger imports of missing deps) because the code isn’t top-level​[blog.ionelmc.ro](https://blog.ionelmc.ro/2014/05/25/python-packaging/#the-structure#:~:text=,possible%20in%20the%20first%20place).
    

PyPA’s packaging guide and tutorial explicitly recommend the `src/` layout for new projects. For instance, the pyOpenSci packaging guide “strongly suggests (but does not require)” using `src/`, noting that this layout is recommended by the PyPA Packaging Guide​[pyopensci.org](https://www.pyopensci.org/python-package-guide/package-structure-code/python-package-structure.html#:~:text=We%20strongly%20suggest%2C%20but%20do,the%20PyPA%20packaging%20guide%20tutorial). The pytest documentation likewise notes that using a `src/` layout “prevents a lot of common pitfalls and has many benefits,” citing Ionel Mărieș’s blog for details​[docs.pytest.org](https://docs.pytest.org/en/7.1.x/explanation/goodpractices.html#:~:text=Generally%2C%20but%20especially%20if%20you,mypkg). In short, authoritative sources agree that for publishable libraries, `src/` tends to be more robust.

## Advantages of `src/` Layout

- **Correct imports/test coverage:** As noted, your tests (and any runtime code) naturally use the installed package. This avoids the “it works on my machine” trap. By testing the installed code, you ensure what you upload to PyPI actually runs. In addition, tools like coverage generate reports based on the installed package path (ensuring accurate paths) when using a src layout​[pyopensci.org](https://www.pyopensci.org/python-package-guide/package-structure-code/python-package-structure.html#:~:text=The%20benefit%20of%20using%20the,when%20your%20package%20is%20installed).
    
- **Avoids shadowing and name conflicts:** With `src/`, you cannot accidentally import a local module named the same as a standard library or another package, because the working directory doesn’t contain your code. This improves reliability of build and CI scripts. For example, the packaging docs point out that without `src/`, an import in your project directory could succeed only in development (when files are top-level) but fail in a deployed install​[packaging.python.org](https://packaging.python.org/en/latest/discussions/src-layout-vs-flat-layout/#:~:text=The%20flat%20layout%20would%20add,installations%20but%20not%20regular%20installations).
    
- **Clearer project structure:** A `src/` directory cleanly separates source code from configuration, docs, tests, etc. Many find this clarity helpful: code is always under `src/`, while `tests/`, `docs/`, CI scripts, and so on remain in the root. The pyOpenSci guide even calls the src layout “semantically more clear” for this reason.
    
- **Tooling support:** Modern Python packaging tools recognize `src/` by default. For example, Poetry’s project generator uses src layout by default (with a `--flat` flag to opt out)​[python-poetry.org](https://python-poetry.org/docs/cli/#:~:text=poetry%20new%20my)​[python-poetry.org](https://python-poetry.org/docs/cli/#:~:text=If%20you%20want%20to%20use,flat%60%20option), and Poetry’s resolver automatically finds packages under `src/`. PyPA’s recommended build backends (setuptools, flit, Poetry) support src without extra config, and many cookiecutter templates use it. Even pytest and other tools explicitly recommend it​[docs.pytest.org](https://docs.pytest.org/en/7.1.x/explanation/goodpractices.html#:~:text=Generally%2C%20but%20especially%20if%20you,mypkg). (Notably, newer versions of setuptools now explicitly recognize and support `src/` layouts, as James Bennett observes​[b-list.org](https://www.b-list.org/weblog/2023/dec/15/python-packaging-src-layout/#:~:text=This%20is%20not%20the%20only,listened%20when%20he%20wrote%20that%C2%A0post).)
    

## Disadvantages and Trade-offs

- **Must install to run code:** A clear downside is that you _have to_ install the project (often in editable mode) before running it. You cannot simply `python main.py` from the source tree. As the PyPA guide notes, a CLI tool in a src layout _“cannot be run directly from the source tree, but requires installation of the package in development mode”_​[packaging.python.org](https://packaging.python.org/en/latest/discussions/src-layout-vs-flat-layout/#:~:text=Running%20a%20command,layout%C2%B6). (They suggest workarounds like adjusting `sys.path` in `__main__.py`, but those are extra steps.) In practice this means a development workflow has an extra `pip install -e .` step before testing or running the code.
    
- **Slightly more complexity for beginners:** Some users feel `src/` adds an “unnecessary extra layer” to file paths​[github.com](https://github.com/astropy/astropy/issues/13678#:~:text=,layout). New developers must remember to install the package or use `python -m`, whereas flat layout lets you import directly from the project root. It can be confusing if you forget and wonder why running tests fails. Documentation and tutorials must explain the extra step. (Some recommend always running tests with `python -Im pytest` or similar to avoid path issues​[b-list.org](https://www.b-list.org/weblog/2023/dec/15/python-packaging-src-layout/#:~:text=There%20are%20two%20things%20you,a%20lot%20of%20easy%20attack%C2%A0vectors).)
    
- **Inconvenient for quick scripts or small apps:** For a tiny script or quick-and-dirty project that won’t be published, the src layout may feel like overkill. If you’re not packaging your code at all, the benefit is moot and flat might be simpler. Indeed, many established scientific and data packages (NumPy, SciPy, Pandas, etc.) continue using a flat layout for historical reasons​[pyopensci.org](https://www.pyopensci.org/python-package-guide/package-structure-code/python-package-structure.html#:~:text=It%20would%20be%20a%20significant,not%20worth%20the%20maintenance%20investment)​[github.com](https://github.com/astropy/astropy/issues/13678#:~:text=,layout), since migrating them is a huge effort. For such big codebases, organizations often prioritize stability and consistency over the advantages of `src/`.
    
- **Coverage and test configuration:** Testing and coverage tools sometimes need explicit instructions. For example, if you run tests against the installed package (as you should), coverage reports may show absolute paths or need to combine data across environments​[stackoverflow.com](https://stackoverflow.com/questions/72054945/how-to-run-coverage-for-a-python-project-with-src-layout#:~:text=2). Configuring PyTest with `--import-mode=importlib` (as recommended) or adjusting coverage source settings can address this, but it’s an extra configuration point.
    

## Flat vs. `src/`: When to Use Which

The **flat layout** (package at root) remains common, especially for existing projects or simple apps. Its main advantages are familiarity and immediacy: you can import your package from the root without installing, and there’s no extra directory depth. The Hitchhiker’s Guide and older recipes typically showed this structure (e.g. `setup.py` and `mypkg/` side-by-side)​[docs.python-guide.org](https://docs.python-guide.org/writing/structure/#:~:text=If%20your%20module%20consists%20of,the%20root%20of%20your%20repository). Major libraries like NumPy, SciPy, and Pandas use flat layout, partly to avoid disrupting long-time users​[pyopensci.org](https://www.pyopensci.org/python-package-guide/package-structure-code/python-package-structure.html#:~:text=It%20would%20be%20a%20significant,not%20worth%20the%20maintenance%20investment)​[github.com](https://github.com/astropy/astropy/issues/13678#:~:text=,layout). Flat layout also historically allowed running scripts with `python -m mypkg` out of the box.

However, flat layout carries risks: as James Bennett and others have documented, it can silently hide packaging errors because local imports mask missing files in the distributed package​[b-list.org](https://www.b-list.org/weblog/2023/dec/15/python-packaging-src-layout/#:~:text=The%20other%20thing%20is%E2%80%A6%20stop,longer%20implicitly%20on%20the%20import%C2%A0path)​[pyopensci.org](https://www.pyopensci.org/python-package-guide/package-structure-code/python-package-structure.html#:~:text=This%20means%20that%20if%20you,it%20discovers%20the%20installed%20package). In contrast, `src/` explicitly **tests the installation process**, which is crucial for production packages.

**Recommendations:** For new libraries or applications meant to be distributed (especially public packages), the consensus from packaging experts is to use `src/`. PyPA tutorials and PyOpenSci suggest `src/` as a more fail-safe default​[pyopensci.org](https://www.pyopensci.org/python-package-guide/package-structure-code/python-package-structure.html#:~:text=We%20strongly%20suggest%2C%20but%20do,the%20PyPA%20packaging%20guide%20tutorial)​[pyopensci.org](https://www.pyopensci.org/python-package-guide/package-structure-code/python-package-structure.html#:~:text=The%20benefit%20of%20using%20the,when%20your%20package%20is%20installed). New projects created with modern tools (e.g. `poetry new myproject`) will default to `src/` unless explicitly asked otherwise​[python-poetry.org](https://python-poetry.org/docs/cli/#:~:text=poetry%20new%20my).

That said, flat layout may be acceptable for very simple, private projects or for teams that prefer it. If sticking with flat, one should adopt strict testing habits (e.g. always test in an isolated environment with `python -Im pytest`) to catch the same errors that `src/` would avoid​[b-list.org](https://www.b-list.org/weblog/2023/dec/15/python-packaging-src-layout/#:~:text=There%20are%20two%20things%20you,a%20lot%20of%20easy%20attack%C2%A0vectors). PyOpenSci even notes that both layouts have pros – flat has stability with existing habits, while src offers robustness – and recommends choosing based on project needs​[github.com](https://github.com/astropy/astropy/issues/13678#:~:text=,layout).

## Real-World Examples

- **Project templates:** Many official templates use `src/`. For example, Microsoft’s Python-package template (Flit-based) explicitly places source under `src/`​[github.com](https://github.com/microsoft/python-package-template#:~:text=such%20as%20the%20Python%20interpreter,check%2C%20and%20analyze%20Python%20code), and notes “Place new source code here.” Poetry’s `poetry new` command creates a `src/` layout by default (with a `--flat` option to opt out)​[python-poetry.org](https://python-poetry.org/docs/cli/#:~:text=poetry%20new%20my). Cookiecutter templates like “cookiecutter-pypackage-src” also enforce this structure.
    
- **Open-source libraries:** Numerous modern libraries use `src/`. The popular `cryptography` library (PyCA) organizes its code under `src/cryptography`​[github.com](https://github.com/pyca/cryptography/tree/main/src#:~:text=_cffi_src). Many PyPA-related projects and recent packages (often cited as examples) have moved to `src/`. For instance, the World Bank’s BlackMarblePy project puts its package under `src/blackmarble`​[github.com](https://github.com/worldbank/blackmarblepy#:~:text=src%2F%20blackmarble), and their GOSTnets tool uses `src/GOSTnets`​[github.com](https://github.com/worldbank/GOStnets#:~:text=src%2F%20GOSTnets). The pytest documentation notes that this pattern is becoming the norm (“the excellent blog post by Ionel” on `src/` is cited)​[docs.pytest.org](https://docs.pytest.org/en/7.1.x/explanation/goodpractices.html#:~:text=Generally%2C%20but%20especially%20if%20you,mypkg).
    
- **Institutional projects:** Community and organizational guidelines encourage `src/`. As mentioned, the pyOpenSci packaging guide strongly suggests `src/` for new packages​[pyopensci.org](https://www.pyopensci.org/python-package-guide/package-structure-code/python-package-structure.html#:~:text=We%20strongly%20suggest%2C%20but%20do,the%20PyPA%20packaging%20guide%20tutorial). Even large projects have debated it: for example, Astropy developers discussed adopting `src/` (citing the “Scientific Python packaging guide” recommendation) but also weighed the effort against keeping consistency with legacy flat-structured packages like NumPy and SciPy​[github.com](https://github.com/astropy/astropy/issues/13678#:~:text=Scientific%20Python%20packaging%20guide%20recommends,layout)​[github.com](https://github.com/astropy/astropy/issues/13678#:~:text=,layout). In their discussions, maintainers acknowledged PyOpenSci’s recommendation and found it “compelling”​[github.com](https://github.com/astropy/astropy/issues/13678#:~:text=eteq%20%20%20commented%20,129), even if they ultimately decided based on their own roadmap.
    
- **Expert endorsements:** Beyond docs, experts preach `src/`. James Bennett wrote that one should “stop putting your module at the top level” and use `src/`, noting that modern tooling (setuptools, etc.) now makes it easy​[b-list.org](https://www.b-list.org/weblog/2023/dec/15/python-packaging-src-layout/#:~:text=The%20other%20thing%20is%E2%80%A6%20stop,longer%20implicitly%20on%20the%20import%C2%A0path). The pytest team “strongly suggest” it as a best practice​[docs.pytest.org](https://docs.pytest.org/en/7.1.x/explanation/goodpractices.html#:~:text=Generally%2C%20but%20especially%20if%20you,mypkg). On the other hand, tools like the new `uv` CLI opted for flat by default for simplicity, prompting community members to recommend always using the `--package` (src) mode instead​[jcheng.org](https://www.jcheng.org/post/python-and-the-src-vs-flat-layout-debate/#:~:text=The%20flat%20layout%20seems%20simpler,downsides%20to%20using%20src%20layout)​[jcheng.org](https://www.jcheng.org/post/python-and-the-src-vs-flat-layout-debate/#:~:text=,in%201ms%20Hello%20from%20uvpackage).
    

**Summary:** In practice, many current Python projects – especially those intended for distribution – adopt `src/` for its reliability benefits. It has strong backing from PyPA guides, packaging experts, and most modern tools. Flat layout persists in legacy and simple projects, but in those cases developers must be careful about import paths. By contrast, `src/` enforces good practices (test the install, avoid path confusion) at the cost of an extra install step. The choice should consider project size and goals: for a serious library or application meant for wide use, `src/` is generally recommended​[pyopensci.org](https://www.pyopensci.org/python-package-guide/package-structure-code/python-package-structure.html#:~:text=We%20strongly%20suggest%2C%20but%20do,the%20PyPA%20packaging%20guide%20tutorial)​[pyopensci.org](https://www.pyopensci.org/python-package-guide/package-structure-code/python-package-structure.html#:~:text=The%20benefit%20of%20using%20the,when%20your%20package%20is%20installed).

**Sources:** Detailed discussions and guidelines can be found in the Python Packaging User Guide (PyPA)​[packaging.python.org](https://packaging.python.org/en/latest/discussions/src-layout-vs-flat-layout/#:~:text=,development%20copy%20of%20the%20code)​[packaging.python.org](https://packaging.python.org/en/latest/discussions/src-layout-vs-flat-layout/#:~:text=,were%20meant%20to%20be%20importable), the pytest documentation​[docs.pytest.org](https://docs.pytest.org/en/7.1.x/explanation/goodpractices.html#:~:text=Generally%2C%20but%20especially%20if%20you,mypkg), blog posts by industry experts​[blog.ionelmc.ro](https://blog.ionelmc.ro/2014/05/25/python-packaging/#the-structure#:~:text=,working%20directory%20as%20you%20do)​[b-list.org](https://www.b-list.org/weblog/2023/dec/15/python-packaging-src-layout/#:~:text=The%20other%20thing%20is%E2%80%A6%20stop,longer%20implicitly%20on%20the%20import%C2%A0path), and organization guides like pyOpenSci​[pyopensci.org](https://www.pyopensci.org/python-package-guide/package-structure-code/python-package-structure.html#:~:text=We%20strongly%20suggest%2C%20but%20do,the%20PyPA%20packaging%20guide%20tutorial)​[pyopensci.org](https://www.pyopensci.org/python-package-guide/package-structure-code/python-package-structure.html#:~:text=The%20benefit%20of%20using%20the,when%20your%20package%20is%20installed). Real project examples are cited above to illustrate the layout. All citations link to relevant documentation and community resources.