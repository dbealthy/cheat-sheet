Source: https://habr.com/ru/articles/808817/, https://habr.com/ru/articles/784186/

Паттерн UoW является абстракцией вокруг целостности данных

В некоторых случаях в UseCase мы хотим использовать транзакции, например, чтобы записать несколько сущностей в базу через репозиторий. Есть несколько варинатов как это можно было бы сделать:
- Поместить Transaction.Begin прям в application layer UserCase, что в конечном итоге приводит к нарушению принципов CA и других принципов, усложнаяет поддержку, тестирование ...
- Поместить бизнес логику в репозиторий, что приведет к распуханию репозиториев, нарушению SRP и усложняет переиспользование, ухудшает тестируемость и связывает логику application с базой данных
- Использовать специальный класс (UnitOfWork), который будет отвечать за управление транзакциями и давать доступ к репозиториям 


- Бывает явная реализация UoW, когда в сервисной логике мы вызвает коммит у UoW при подтверждении, если же commit не был вызван или произошла ошибка, изменения откатываются. Такой подход считается более понятным и выразительным

- Есть так же неявный, когда при выходи из контекста код автоматически коммитится, при этом если произошла ошибка просиходит ролбэк, если код вышел из контекстного менеджера он автоматически коммитится
  
- В одном Unit Of Work должны находится все репозитории, которые:
	- Находятся в одном транзакционном контексте, используются вместе
	- Используют одну базу данных
	- Принадлежат одному bounded context (домену)

- UnitOfWork создает свою собственную сессию во время открытия, и эта сессия доступна всем репозитория, которые прикреплены к нему. NOTE: Т.к. UOW использует свою сессию могут быть ошибки если вместе с UOW используется другой репозиторий, который достает какие то данные и передает их на сохранение в UOW (объекты)


Неявная реализация
``` python
class AbstractUnitOfWork(abc.ABC):
	def __enter__(self):
		return self
	def __exit__(self, exn_type, exn_value, traceback):
		if exn_type is None:
			self.commit() 
		else:
			self.rollback()
```


Явная реализация
``` python
class AbstractUnitOfWork(abc.ABC):
	def __exit__(self, *args): 
		self.rollback()
		
	@abc.abstractmethod
	def commit(self): 
		raise NotImplementedError
		
	@abc.abstractmethod
	def rollback(self): 
		raise NotImplementedError
```